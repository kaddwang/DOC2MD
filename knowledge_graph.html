<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAAC Knowledge Graph (Dark)</title>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
  :root {
    --bg-color: #0d1117; /* GitHub Dark */
    --panel-bg: rgba(22, 27, 34, 0.9);
    --text-primary: #E0E0E0;
    --border-color: rgba(255, 255, 255, 0.1);
  }
  
  * { margin:0; padding:0; box-sizing:border-box; outline:none; -webkit-font-smoothing: antialiased; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg-color);
    color: var(--text-primary);
    overflow: hidden;
  }

  #graph-container { width:100vw; height:100vh; background: #0d1117; }

  /* FLOATING PANEL */
  .floating-panel {
    position: fixed; z-index: 100;
    background: var(--panel-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--border-color);
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    border-radius: 14px;
    transition: all 0.3s ease;
  }

  /* TOP BAR */
  #top-bar {
    top: 20px; left: 20px; right: 20px;
    padding: 12px 24px;
    display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
    max-width: 1400px; margin: 0 auto;
  }
  
  .app-title { font-weight: 700; color: #fff; font-size: 16px; display:flex; align-items:center; gap:8px; }
  .app-title span { font-weight:400; font-size:12px; opacity:0.6; border:1px solid #555; padding:2px 6px; border-radius:4px; }

  /* Search */
  .search-wrapper { position: relative; flex: 1; max-width: 320px; }
  .search-wrapper input {
    width: 100%; padding: 8px 12px 8px 36px;
    border-radius: 8px; border: 1px solid #30363d;
    background: #0d1117; color: #fff;
    font-size: 13px;
  }
  .search-wrapper input:focus { border-color: #58a6ff; }
  .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; }

  /* Filters */
  .filter-group { display: flex; gap: 8px; }
  .filter-btn {
    border: 1px solid #30363d; background: transparent; 
    padding: 6px 14px; border-radius: 20px; font-size: 12px; color: #8b949e;
    cursor: pointer; transition: all 0.2s;
  }
  .filter-btn:hover { border-color: #8b949e; color: #c9d1d9; }
  .filter-btn.active { background: #58a6ff; border-color: #58a6ff; color: #fff; }

  /* Actions */
  .action-btn {
    padding: 8px 18px; border-radius: 20px; border: none;
    font-size: 12px; font-weight: 600; cursor: pointer;
    background: #238636; color: #fff;
  }
  .action-btn:hover { background: #2ea043; }
  
  /* LEGEND */
  #legend {
    bottom: 24px; left: 24px; padding: 16px; width: 180px;
  }
  .legend-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 12px; }
  .circle { width: 12px; height: 12px; border-radius: 50%; }

  /* DETAIL PANEL */
  #detail-panel {
    top: 80px; right: 24px; bottom: 24px; width: 400px;
    transform: translateX(120%); padding: 0; display: flex; flex-direction: column;
    background: rgba(20, 20, 23, 0.95); /* Darker, more solid */
    border: 1px solid rgba(255,255,255,0.15);
  }
  #detail-panel.open { transform: translateX(0); }
  
  .panel-header { padding: 24px 24px 0; }
  .panel-title { font-size: 24px; font-weight: 700; color: #fff; margin-bottom: 8px; line-height: 1.3; }
  .panel-badges { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
  .badge { font-size: 10px; padding: 4px 10px; border-radius: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: #000; }
  
  /* TABS */
  .panel-tabs { display: flex; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 0 24px; margin-top: 16px; }
  .tab-btn {
    background: transparent; border: none; color: #8b949e; 
    padding: 12px 0; margin-right: 24px; font-size: 13px; font-weight: 600; 
    cursor: pointer; position: relative; transition: color 0.2s;
  }
  .tab-btn:hover { color: #fff; }
  .tab-btn.active { color: #58a6ff; }
  .tab-btn.active::after {
    content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: #58a6ff;
  }

  .panel-body { flex: 1; overflow-y: auto; padding: 24px; }
  
  /* SECTIONS */
  .section-title { font-size: 11px; text-transform: uppercase; color: #8b949e; margin-bottom: 12px; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
  .section-title::after { content:''; height:1px; background:rgba(255,255,255,0.1); flex:1; }
  
  .def-box { 
    background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; 
    margin-bottom: 24px; border-left: 3px solid #58a6ff;
  }
  .def-text { font-size: 14px; line-height: 1.6; color: #e0e0e0; white-space: pre-line; }

  /* METRICS GRID */
  .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; }
  .metric-card { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
  .metric-val { font-size: 20px; font-weight: 700; color: #fff; display: block; margin-bottom: 4px; }
  .metric-label { font-size: 11px; color: #8b949e; text-transform: uppercase; }

  /* RELATIONS LIST */
  .flow-group { margin-bottom: 24px; }
  .flow-header { font-size: 12px; color: #fff; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
  .flow-count { background: rgba(255,255,255,0.1); padding: 1px 6px; border-radius: 8px; font-size: 10px; color: #aaa; }
  
  .rel-item {
    display: flex; align-items: center; gap: 12px;
    padding: 10px 12px; border-radius: 8px; margin-bottom: 6px;
    background: rgba(255,255,255,0.03); cursor: pointer; 
    transition: all 0.2s; border: 1px solid transparent;
  }
  .rel-item:hover { background: rgba(88,166,255,0.1); border-color: rgba(88,166,255,0.3); transform: translateX(4px); }
  .rel-dir { font-size: 10px; font-weight: 700; width: 24px; text-align: center; opacity: 0.7; }
  .rel-name { font-size: 13px; color: #fff; flex: 1; }
  .rel-tag { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: rgba(0,0,0,0.3); color: #8b949e; }

  /* RISK ALERT */
  .risk-alert { 
    background: rgba(255, 69, 58, 0.1); border: 1px solid rgba(255, 69, 58, 0.3);
    color: #ff453a; padding: 12px; border-radius: 8px; font-size: 13px; margin-bottom: 20px;
    display: flex; gap: 10px; align-items: start;
  }

  .tab-content { display: none; }
  .tab-content.active { display: block; }


</style>
</head>
<body>

<div id="top-bar" class="floating-panel">
  <div class="app-title">MAAC <span>Graph</span></div>
  <div class="search-wrapper">
    <span class="search-icon">üîç</span>
    <input type="text" id="search" placeholder="Search...">
  </div>
  <div class="filter-group">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="module">Modules</button>
    <button class="filter-btn" data-filter="subfeature">Features</button>
    <button class="filter-btn" data-filter="infra">Infra</button>
  </div>
  <div style="flex:1"></div>
  <button class="action-btn" onclick="network.fit({animation:true})">Reset Zoom</button>
</div>

<div id="graph-container"></div>

<div id="legend" class="floating-panel">
  <div class="legend-row"><div class="circle" style="background:#A371F7"></div> Platform</div>
  <div class="legend-row"><div class="circle" style="background:#58A6FF"></div> Module</div>
  <div class="legend-row"><div class="circle" style="background:#3FB950"></div> Feature</div>
  <div class="legend-row"><div class="circle" style="background:#D29922"></div> Infra</div>
  <div class="legend-row"><div class="circle" style="background:#F778BA"></div> Data</div>
</div>

<div id="detail-panel" class="floating-panel">
  <button onclick="document.getElementById('detail-panel').classList.remove('open')" style="position:absolute;top:16px;right:16px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer">√ó</button>
  <div id="detail-content"></div>
</div>

<script>
const RAW_DATA = {"nodes": [{"id": 1, "label": "MAAC Platform", "group": "platform", "title": "Marketing Automation & Analytics Center\nCrescendo Lab's core product platform", "size": 60}, {"id": 2, "label": "Contact\nManagement", "group": "module", "title": "ËÅØÁµ°‰∫∫ÁÆ°ÁêÜÊ†∏ÂøÉ\nÁÆ°ÁêÜÊâÄÊúâÈÄöË∑ØÁöÑËÅØÁµ°‰∫∫Ë≥áÊñô\nÂåÖÂê´ LINE / FB / IG / Phone / Email", "size": 50}, {"id": 3, "label": "Segment", "group": "module", "title": "ÂàÜÁúæÂºïÊìé\nÊ†πÊìöÊ¢ù‰ª∂ÁØ©ÈÅ∏ËÅØÁµ°‰∫∫Áæ§ÁµÑ\nÊîØÊè¥ÈùúÊÖã/ÂãïÊÖãÂàÜÁúæ", "size": 45}, {"id": 4, "label": "Tag\nManager", "group": "module", "title": "Ê®ôÁ±§Á≥ªÁµ±\nTag CRUD„ÄÅËá™ÂãïÂä†Ê®ô„ÄÅÊ®ôÁ±§ÂàÜÊûê", "size": 45}, {"id": 5, "label": "Broadcast", "group": "module", "title": "Êé®Êí≠‰∏≠ÂøÉ\nÊéíÁ®ãÊé®Êí≠„ÄÅA/B Ê∏¨Ë©¶„ÄÅÂ§öÈÄöË∑ØÁôºÈÄÅ", "size": 50}, {"id": 6, "label": "Auto-reply", "group": "module", "title": "Ëá™ÂãïÂõûË¶Ü\nÈóúÈçµÂ≠óËß∏Áôº„ÄÅÊôÇÈñìÈôêÂà∂„ÄÅÈáçË§áÊéßÂà∂", "size": 45}, {"id": 7, "label": "Customer\nJourney", "group": "module", "title": "Ëá™ÂãïÂåñÊóÖÁ®ã\nÂ§öÊ≠•È©üËá™ÂãïÂåñÊµÅÁ®ã„ÄÅËß∏ÁôºÂô®„ÄÅÂãï‰ΩúÁØÄÈªû\nÂåÖÂê´ EDM Êï¥Âêà", "size": 55}, {"id": 8, "label": "Rich Menu", "group": "module", "title": "LINE ÂúñÊñáÈÅ∏ÂñÆ\nÊéíÁ®ã„ÄÅÂàÜÁúæÈ°ØÁ§∫„ÄÅÈÄ£ÁµêÁÆ°ÁêÜ", "size": 40}, {"id": 9, "label": "Insight\n& Reports", "group": "module", "title": "Êï∏ÊìöÂàÜÊûê\nTag Ë¶ÜËìãÁéá„ÄÅÁç≤ÂÆ¢ÊºèÊñó„ÄÅË®äÊÅØÁµ±Ë®à\nÊØèÊó•/ÊØèÈÄ±Â†±Ë°®", "size": 50}, {"id": 10, "label": "Deeplink", "group": "module", "title": "Ê∑±Â∫¶ÈÄ£Áµê\nUTM ËøΩËπ§„ÄÅÁç≤ÂÆ¢‰æÜÊ∫êÊ≠∏Âõ†", "size": 40}, {"id": 11, "label": "Tracelink", "group": "module", "title": "ÈÄ£ÁµêËøΩËπ§\nÈªûÊìäÂàÜÊûê„ÄÅËΩâÊèõËøΩËπ§", "size": 35}, {"id": 12, "label": "Prize\nManagement", "group": "module", "title": "ÁçéÂìÅÁÆ°ÁêÜ\nÁçéÂìÅÊ±†„ÄÅÂÖåÊèõÁ¢º„ÄÅÊäΩÁçéÁ≥ªÁµ±", "size": 35}, {"id": 13, "label": "Template\nLibrary", "group": "module", "title": "ÁØÑÊú¨Â∫´\nË®äÊÅØÁØÑÊú¨„ÄÅÂèØÈáçÁî®ÂÖßÂÆπÂçÄÂ°ä", "size": 35}, {"id": 14, "label": "Contact\nProfile", "group": "subfeature", "title": "ËÅØÁµ°‰∫∫Ê™îÊ°à\nÂßìÂêç„ÄÅÈõªË©±„ÄÅEmail„ÄÅËá™Ë®ÇÊ¨Ñ‰Ωç\nÂç≥ÊôÇÁ∑®ËºØËàáÂêåÊ≠•", "size": 25}, {"id": 15, "label": "Profile\nUnification", "group": "subfeature", "title": "Ë∑®ÈÄöË∑ØÂêà‰Ωµ\nLINE + SMS + Email Âêà‰ΩµÁÇ∫ÂñÆ‰∏ÄËÅØÁµ°‰∫∫\nÂêà‰ΩµÊ¨äÈáçÈÇèËºØ„ÄÅÊ¨Ñ‰ΩçË¶ÜÂØ´ÂÑ™ÂÖàÈ†ÜÂ∫è", "size": 30}, {"id": 16, "label": "Contact\nImport", "group": "subfeature", "title": "ËÅØÁµ°‰∫∫ÂåØÂÖ•\nCSV / API ÂåØÂÖ•„ÄÅKey Value ÂåπÈÖç\nÊîØÊè¥ line_uid / customer_id / phone / email", "size": 25}, {"id": 17, "label": "UID\nBinding", "group": "subfeature", "title": "Ë∫´‰ªΩÁ∂ÅÂÆö\nline_uid ‚Üî customer_id Â∞çÊáâ\nBindlink ÂõûÂëº„ÄÅCID Á∂ÅÂÆöÈÇèËºØ", "size": 25}, {"id": 18, "label": "Friend\nStatus", "group": "subfeature", "title": "LINE Â•ΩÂèãÁãÄÊÖã\nAuth / Following / Blocked\nÊ†πÊìö Webhook ‰∫ã‰ª∂ËøΩËπ§", "size": 20}, {"id": 19, "label": "Display\nName", "group": "subfeature", "title": "È°ØÁ§∫ÂêçÁ®±ÈÇèËºØ\ndisplay_name vs original_name\n‰æùË≥¥ LINE Channel Token ÂêåÊ≠•", "size": 20}, {"id": 20, "label": "Contact\nFields", "group": "subfeature", "title": "ËÅØÁµ°‰∫∫Ê¨Ñ‰Ωç\nname, phone, email, customer_id,\ntags, custom fields\nÊ¨Ñ‰ΩçÊõ¥Êñ∞Ë¶èÂâáÔºöÊúâÂÄºË¶ÜÂØ´„ÄÅÁ©∫ÂÄº‰øùÁïô", "size": 25}, {"id": 21, "label": "Filter\nConditions", "group": "subfeature", "title": "ÁØ©ÈÅ∏Ê¢ù‰ª∂ÂºïÊìé\nAND / OR ÈÇèËºØ„ÄÅTag ÁØ©ÈÅ∏\nÊó•Êúü„ÄÅ‰∫íÂãï„ÄÅ‰æÜÊ∫êÁ≠âÂ§öÈáçÊ¢ù‰ª∂", "size": 25}, {"id": 22, "label": "Dynamic\nSegment", "group": "subfeature", "title": "ÂãïÊÖãÂàÜÁúæ\nÊ¢ù‰ª∂ËÆäÊõ¥ÊôÇËá™ÂãïÊõ¥Êñ∞ÊàêÂì°\nËÉåÊôØÊéíÁ®ãË®àÁÆó", "size": 20}, {"id": 23, "label": "Tag\nCRUD", "group": "subfeature", "title": "Ê®ôÁ±§ÁÆ°ÁêÜ\nÂª∫Á´ã„ÄÅÁ∑®ËºØ„ÄÅÂà™Èô§Ê®ôÁ±§\nÊ®ôÁ±§ÂêçÁ®±„ÄÅÊéíÂ∫è", "size": 20}, {"id": 24, "label": "Auto-tag\nRules", "group": "subfeature", "title": "Ëá™ÂãïÂä†Ê®ôË¶èÂâá\n‰æù‰∫ã‰ª∂/Ë°åÁÇ∫Ëá™ÂãïÊ®ôË®òËÅØÁµ°‰∫∫", "size": 20}, {"id": 25, "label": "Message\nSend", "group": "subfeature", "title": "Ë®äÊÅØÁôºÈÄÅÂºïÊìé\nÊéíÁ®ãÁôºÈÄÅ„ÄÅÂç≥ÊôÇÁôºÈÄÅ\nÂ§öÈÄöË∑ØÔºàLINE / SMS / EmailÔºâ", "size": 25}, {"id": 26, "label": "A/B\nTesting", "group": "subfeature", "title": "A/B Ê∏¨Ë©¶\nÂ§öÁâàÊú¨Ë®äÊÅØÊØîËºÉ\nËá™ÂãïÈÅ∏ÊìáÊúÄ‰Ω≥ÁâàÊú¨", "size": 18}, {"id": 27, "label": "Audience\nTargeting", "group": "subfeature", "title": "ÂèóÁúæË®≠ÂÆö\n‰æù Segment ÈÅ∏ÊìáÊé®Êí≠Â∞çË±°", "size": 20}, {"id": 28, "label": "Keyword\nMatching", "group": "subfeature", "title": "ÈóúÈçµÂ≠óÊØîÂ∞ç\nÂÆåÂÖ®/ÈÉ®ÂàÜÂåπÈÖç„ÄÅÊ≠£Ââá\nËß∏ÁôºÂÑ™ÂÖàÈ†ÜÂ∫èÈÇèËºØ", "size": 20}, {"id": 29, "label": "Time & Reply\nLimits", "group": "subfeature", "title": "ÊôÇÈñì & Ê¨°Êï∏ÈôêÂà∂\nÂÜ∑ÂçªÊôÇÈñì„ÄÅÊØè‰∫∫ÊúÄÂ§ßÂõûË¶ÜÊ¨°Êï∏\nÈáçË§áË®äÊÅØÊéßÂà∂", "size": 20}, {"id": 30, "label": "Channel\nRestrictions", "group": "subfeature", "title": "ÈÄöË∑ØÈôêÂà∂\nMeta (FB/IG) ‰∏çÊîØÊè¥Êñ∞Â•ΩÂèãÈóúÈçµÂ≠óÂõûË¶Ü\nLINE / WhatsApp ÊîØÊè¥", "size": 18}, {"id": 31, "label": "Trigger\nEngine", "group": "subfeature", "title": "Ëß∏ÁôºÂºïÊìé\nEvent-BasedÔºöWebhook ‰∫ã‰ª∂È©ÖÂãï\nTime-BasedÔºöÊéíÁ®ãËß∏Áôº (Airflow)", "size": 30}, {"id": 32, "label": "Action\nNodes", "group": "subfeature", "title": "Âãï‰ΩúÁØÄÈªû\nSend Message / Add Tag / Wait\nCondition Split / A/B Split", "size": 30}, {"id": 33, "label": "EDM / Email\nAction", "group": "subfeature", "title": "Email ÁôºÈÄÅÁØÄÈªû\nMAAC ‚Üí Epistola ‚Üí SendGrid\nToken Exchange / iframe Á∑®ËºØÂô®", "size": 25}, {"id": 34, "label": "Member\nProgress", "group": "subfeature", "title": "ÊàêÂì°ÈÄ≤Â∫¶ËøΩËπ§\nREADY ‚Üí RUNNING ‚Üí WAITING ‚Üí ENDED\nÁãÄÊÖãÊ©üÁÆ°ÁêÜ", "size": 20}, {"id": 35, "label": "Node\nPerformance", "group": "subfeature", "title": "ÁØÄÈªûÁ∏æÊïàÊåáÊ®ô\nÊØèÁØÄÈªû send/open/click Áéá\nJourney Êï¥È´îËΩâÊèõÊºèÊñó", "size": 20}, {"id": 36, "label": "Tag\nCoverage", "group": "subfeature", "title": "Ê®ôÁ±§Ë¶ÜËìãÁéá\nÂÖ®ÂìÅÁâåÊ®ôÁ±§‰ΩøÁî®Áµ±Ë®à\n‰æùË≥¥ Airflow Êó•Â†±Ë°®", "size": 20}, {"id": 37, "label": "Acquisition\nFunnel", "group": "subfeature", "title": "Áç≤ÂÆ¢ÊºèÊñó\nÊñ∞ËÅØÁµ°‰∫∫‰æÜÊ∫ê„ÄÅËΩâÊèõÁéá\nDeeplink Â†±Ë°®", "size": 20}, {"id": 38, "label": "Message\nAnalytics", "group": "subfeature", "title": "Ë®äÊÅØÁµ±Ë®à\nÊé®Êí≠ÊàêÊïà„ÄÅÈñã‰ø°Áéá„ÄÅÈªûÊìäÁéá\nËá™ÂãïÂõûË¶ÜÊéíÂêç", "size": 20}, {"id": 39, "label": "Weekly\nReport", "group": "subfeature", "title": "ÊØèÈÄ±Â†±Ë°®\nËá™ÂãïÂØÑÈÄÅÁµ¶ÂÆ¢Êà∂\n‰æùË≥¥ Airflow ÊéíÁ®ã", "size": 18}, {"id": 40, "label": "UTM\nTracking", "group": "subfeature", "title": "UTM ÂèÉÊï∏ËøΩËπ§\n‰æÜÊ∫ê„ÄÅÂ™í‰ªã„ÄÅÊ¥ªÂãïÊ≠∏Âõ†", "size": 18}, {"id": 41, "label": "Acquisition\nSource", "group": "subfeature", "title": "Áç≤ÂÆ¢‰æÜÊ∫êËøΩËπ§\nÊñ∞ËÅØÁµ°‰∫∫Ê≠∏Âõ†Âà∞ Deeplink", "size": 18}, {"id": 42, "label": "Menu\nScheduling", "group": "subfeature", "title": "ÊéíÁ®ãÁÆ°ÁêÜ\nÊåâÊôÇÈñìÂàáÊèõ‰∏çÂêåÈÅ∏ÂñÆ", "size": 18}, {"id": 43, "label": "Per-audience\nMenu", "group": "subfeature", "title": "ÂàÜÁúæÈÅ∏ÂñÆ\n‰æùÊ®ôÁ±§/ÂàÜÁæ§È°ØÁ§∫‰∏çÂêåÈÅ∏ÂñÆ", "size": 18}, {"id": 44, "label": "Sender\nDomain", "group": "subfeature", "title": "Sender Domain ÁÆ°ÁêÜ\nDNS È©óË≠âÔºöCNAME / DKIM1 / DKIM2 / DMARC\nÈÄèÈÅé SendGrid API È©óË≠â", "size": 20}, {"id": 45, "label": "Channel\nStatus", "group": "subfeature", "title": "Email È†ªÈÅìÁãÄÊÖã\nnot_set ‚Üí connected ‚Üí warning ‚Üí suspended\nHard Bounce > 2% Êàñ Spam > 0.3% ‚Üí warning", "size": 20}, {"id": 46, "label": "CDH", "group": "infra", "title": "Customer Data Hub\nÁµ±‰∏ÄÂÆ¢Êà∂Ë≥áÊñô‰∏≠ÂøÉ\nË∑® MAAC / CAAC ÂêåÊ≠•ËÅØÁµ°‰∫∫", "size": 35}, {"id": 47, "label": "CAAC", "group": "infra", "title": "Conversational Analytics\n& Automation Center\nÂÆ¢ÊúçÂ∞çË©±Âπ≥Âè∞", "size": 30}, {"id": 48, "label": "LINE\nAPI", "group": "infra", "title": "LINE Messaging API\nWebhook„ÄÅPush/Reply Message\nProfile Sync„ÄÅFriend Status", "size": 32}, {"id": 49, "label": "Meta\nAPI", "group": "infra", "title": "Facebook + Instagram API\nË®äÊÅØÊî∂Áôº„ÄÅÁî®Êà∂Ë≥áÊñô\nÊúâÊîøÁ≠ñÈôêÂà∂", "size": 28}, {"id": 50, "label": "SendGrid", "group": "infra", "title": "Email ÁôºÈÄÅÊúçÂãô\nSender Domain È©óË≠â\nBounce / Spam Rate Áõ£Êéß", "size": 28}, {"id": 51, "label": "Airflow", "group": "infra", "title": "Ë≥áÊñôÁÆ°Á∑öÊéíÁ®ã\nÊØèÊó•Â†±Ë°® Pipeline\nÊéßÂà∂ Insight Ë≥áÊñôÊõ¥Êñ∞", "size": 28}, {"id": 52, "label": "RabbitMQ", "group": "infra", "title": "Ë®äÊÅØ‰ΩáÂàó\nJourney ‰∫ã‰ª∂ÂàÜÁôº\nWorker ‰ªªÂãôÊéíÁ®ã", "size": 25}, {"id": 53, "label": "Rubato", "group": "infra", "title": "Journey Ê†∏ÂøÉÂºïÊìé\nËß∏ÁôºË©ï‰º∞„ÄÅÁØÄÈªûÂü∑Ë°å\nÈÄ≤Â∫¶ÁÆ°ÁêÜ", "size": 28}, {"id": 54, "label": "Epistola", "group": "infra", "title": "Email Extension Service\niframe Á∑®ËºØÂô®„ÄÅË®äÊÅØ CRUD\nËàá MAAC Journey Êï¥Âêà", "size": 25}, {"id": 55, "label": "Cloud\nLogging", "group": "infra", "title": "GCP Cloud Logging\n‰∫ã‰ª∂Êó•Ë™åÊî∂ÈõÜ\nJourney Ëß∏Áôº‰∫ã‰ª∂‰æÜÊ∫ê", "size": 25}, {"id": 56, "label": "Contact\nEntity", "group": "data", "title": "ËÅØÁµ°‰∫∫Ë≥áÊñôÁâ©‰ª∂\nline_uid, customer_id, phone, email\nname, tags, custom_fields", "size": 28}, {"id": 57, "label": "Channel\nEntity", "group": "data", "title": "È†ªÈÅìÂØ¶È´î\nLINE / Email / SMS / WhatsApp / FB / IG\nchannel_id, status, config", "size": 25}, {"id": 58, "label": "Tag\nEntity", "group": "data", "title": "Ê®ôÁ±§Áâ©‰ª∂\ntag_id, name, source (maac/cdh)\nËá™ÂãïÊ®ô / ÊâãÂãïÊ®ô", "size": 25}, {"id": 59, "label": "Message\nEntity", "group": "data", "title": "Ë®äÊÅØÁâ©‰ª∂\nÊé®Êí≠/Ëá™ÂãïÂõûË¶Ü/Journey Ë®äÊÅØ\nÁØÑÊú¨„ÄÅRich Content", "size": 25}, {"id": 60, "label": "Event /\nWebhook", "group": "data", "title": "‰∫ã‰ª∂Áâ©‰ª∂\nLINE Webhook, CDH Event\nFollow / Unfollow / Message / Tag Change", "size": 25}], "edges": [{"from": 1, "to": 2, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 3, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 4, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 5, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 6, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 7, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 8, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 9, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 10, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 11, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 12, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 13, "label": "", "edge_type": "hierarchy"}, {"from": 2, "to": 14, "label": "", "edge_type": "contains"}, {"from": 2, "to": 15, "label": "", "edge_type": "contains"}, {"from": 2, "to": 16, "label": "", "edge_type": "contains"}, {"from": 2, "to": 17, "label": "", "edge_type": "contains"}, {"from": 2, "to": 18, "label": "", "edge_type": "contains"}, {"from": 2, "to": 19, "label": "", "edge_type": "contains"}, {"from": 2, "to": 20, "label": "", "edge_type": "contains"}, {"from": 3, "to": 21, "label": "", "edge_type": "contains"}, {"from": 3, "to": 22, "label": "", "edge_type": "contains"}, {"from": 4, "to": 23, "label": "", "edge_type": "contains"}, {"from": 4, "to": 24, "label": "", "edge_type": "contains"}, {"from": 5, "to": 25, "label": "", "edge_type": "contains"}, {"from": 5, "to": 26, "label": "", "edge_type": "contains"}, {"from": 5, "to": 27, "label": "", "edge_type": "contains"}, {"from": 6, "to": 28, "label": "", "edge_type": "contains"}, {"from": 6, "to": 29, "label": "", "edge_type": "contains"}, {"from": 6, "to": 30, "label": "", "edge_type": "contains"}, {"from": 7, "to": 31, "label": "", "edge_type": "contains"}, {"from": 7, "to": 32, "label": "", "edge_type": "contains"}, {"from": 7, "to": 33, "label": "", "edge_type": "contains"}, {"from": 7, "to": 34, "label": "", "edge_type": "contains"}, {"from": 7, "to": 35, "label": "", "edge_type": "contains"}, {"from": 9, "to": 36, "label": "", "edge_type": "contains"}, {"from": 9, "to": 37, "label": "", "edge_type": "contains"}, {"from": 9, "to": 38, "label": "", "edge_type": "contains"}, {"from": 9, "to": 39, "label": "", "edge_type": "contains"}, {"from": 10, "to": 40, "label": "", "edge_type": "contains"}, {"from": 10, "to": 41, "label": "", "edge_type": "contains"}, {"from": 8, "to": 42, "label": "", "edge_type": "contains"}, {"from": 8, "to": 43, "label": "", "edge_type": "contains"}, {"from": 7, "to": 44, "label": "", "edge_type": "contains"}, {"from": 7, "to": 45, "label": "", "edge_type": "contains"}, {"from": 2, "to": 3, "label": "Êèê‰æõËÅØÁµ°‰∫∫", "edge_type": "data_flow"}, {"from": 2, "to": 5, "label": "Êé®Êí≠Â∞çË±°", "edge_type": "data_flow"}, {"from": 2, "to": 7, "label": "ÊóÖÁ®ãÊàêÂì°", "edge_type": "data_flow"}, {"from": 2, "to": 6, "label": "ÂõûË¶ÜÂ∞çË±°", "edge_type": "data_flow"}, {"from": 2, "to": 8, "label": "ÈÅ∏ÂñÆÂ∞çË±°", "edge_type": "data_flow"}, {"from": 2, "to": 9, "label": "Êï∏Êìö‰æÜÊ∫ê", "edge_type": "data_flow"}, {"from": 3, "to": 5, "label": "ÂèóÁúæÁØ©ÈÅ∏", "edge_type": "data_flow"}, {"from": 3, "to": 7, "label": "ÂÖ•Âè£Ê¢ù‰ª∂", "edge_type": "data_flow"}, {"from": 3, "to": 8, "label": "ÂàÜÁúæÈ°ØÁ§∫", "edge_type": "data_flow"}, {"from": 4, "to": 3, "label": "ÁØ©ÈÅ∏Ê¢ù‰ª∂", "edge_type": "data_flow"}, {"from": 4, "to": 2, "label": "Ê®ôË®òËÅØÁµ°‰∫∫", "edge_type": "data_flow"}, {"from": 4, "to": 8, "label": "ÈÅ∏ÂñÆÂàÜÁæ§‰æùÊìö", "edge_type": "data_flow"}, {"from": 4, "to": 7, "label": "Ëß∏Áôº/Âãï‰ΩúÊ¢ù‰ª∂", "edge_type": "data_flow"}, {"from": 4, "to": 9, "label": "Ë¶ÜËìãÁéáÁµ±Ë®à", "edge_type": "data_flow"}, {"from": 5, "to": 9, "label": "Êé®Êí≠ÊàêÊïà", "edge_type": "data_flow"}, {"from": 5, "to": 13, "label": "‰ΩøÁî®ÁØÑÊú¨", "edge_type": "data_flow"}, {"from": 27, "to": 3, "label": "ËÆÄÂèñÂàÜÁúæ", "edge_type": "data_flow"}, {"from": 6, "to": 4, "label": "Ëß∏ÁôºËá™ÂãïÂä†Ê®ô", "edge_type": "data_flow"}, {"from": 6, "to": 9, "label": "ÂõûË¶ÜÁµ±Ë®à", "edge_type": "data_flow"}, {"from": 7, "to": 5, "label": "Ëß∏ÁôºÊé®Êí≠", "edge_type": "data_flow"}, {"from": 7, "to": 4, "label": "Âä†/ÁßªÈô§Ê®ôÁ±§", "edge_type": "data_flow"}, {"from": 7, "to": 2, "label": "Êõ¥Êñ∞ËÅØÁµ°‰∫∫", "edge_type": "data_flow"}, {"from": 7, "to": 12, "label": "ÁçéÂìÅÁôºÊîæ", "edge_type": "data_flow"}, {"from": 10, "to": 2, "label": "Êñ∞ËÅØÁµ°‰∫∫Ê≠∏Âõ†", "edge_type": "data_flow"}, {"from": 10, "to": 9, "label": "Deeplink Â†±Ë°®", "edge_type": "data_flow"}, {"from": 11, "to": 9, "label": "ÈªûÊìäÂ†±Ë°®", "edge_type": "data_flow"}, {"from": 8, "to": 10, "label": "ÈÅ∏ÂñÆÈÄ£Áµê", "edge_type": "data_flow"}, {"from": 12, "to": 7, "label": "Journey ÁçéÂìÅÁØÄÈªû", "edge_type": "data_flow"}, {"from": 12, "to": 5, "label": "Êé®Êí≠‰∏≠ÁôºÁçé", "edge_type": "data_flow"}, {"from": 48, "to": 2, "label": "Webhook ÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 48, "to": 18, "label": "Â•ΩÂèãÁãÄÊÖã‰∫ã‰ª∂", "edge_type": "infra_dep"}, {"from": 48, "to": 19, "label": "Profile ÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 48, "to": 6, "label": "Êé•Êî∂Ë®äÊÅØ", "edge_type": "infra_dep"}, {"from": 48, "to": 5, "label": "Push Message", "edge_type": "infra_dep"}, {"from": 48, "to": 8, "label": "Rich Menu API", "edge_type": "infra_dep"}, {"from": 49, "to": 6, "label": "FB/IG Ë®äÊÅØ", "edge_type": "infra_dep"}, {"from": 49, "to": 30, "label": "ÊîøÁ≠ñÈôêÂà∂", "edge_type": "infra_dep"}, {"from": 50, "to": 33, "label": "Email ÁôºÈÄÅ", "edge_type": "infra_dep"}, {"from": 50, "to": 44, "label": "DNS È©óË≠â", "edge_type": "infra_dep"}, {"from": 50, "to": 45, "label": "Bounce/Spam Áõ£Êéß", "edge_type": "infra_dep"}, {"from": 51, "to": 9, "label": "Êó•Â†±Ë°® Pipeline", "edge_type": "infra_dep"}, {"from": 51, "to": 36, "label": "Tag Ë¶ÜËìãÁéáË®àÁÆó", "edge_type": "infra_dep"}, {"from": 51, "to": 39, "label": "ÈÄ±Â†±ÊéíÁ®ã", "edge_type": "infra_dep"}, {"from": 51, "to": 31, "label": "Time-Based Ëß∏Áôº", "edge_type": "infra_dep"}, {"from": 46, "to": 15, "label": "Áµ±‰∏Ä Profile", "edge_type": "infra_dep"}, {"from": 46, "to": 4, "label": "CDH Tag ÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 46, "to": 3, "label": "CDH ÂàÜÁúæË¶èÂâá", "edge_type": "infra_dep"}, {"from": 46, "to": 47, "label": "ÈõôÂêëÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 53, "to": 31, "label": "Ëß∏ÁôºË©ï‰º∞", "edge_type": "infra_dep"}, {"from": 53, "to": 34, "label": "ÈÄ≤Â∫¶ÁÆ°ÁêÜ", "edge_type": "infra_dep"}, {"from": 52, "to": 53, "label": "‰ªªÂãô‰ΩáÂàó", "edge_type": "infra_dep"}, {"from": 55, "to": 53, "label": "‰∫ã‰ª∂Êó•Ë™å", "edge_type": "infra_dep"}, {"from": 54, "to": 33, "label": "Email Á∑®ËºØ/ÁôºÈÄÅ", "edge_type": "infra_dep"}, {"from": 47, "to": 2, "label": "ÂÆ¢ÊúçÂ∞çË©±Ë≥áÊñô", "edge_type": "infra_dep"}, {"from": 56, "to": 2, "label": "Ê†∏ÂøÉË≥áÊñô", "edge_type": "data_entity"}, {"from": 56, "to": 15, "label": "Âêà‰ΩµÂ∞çË±°", "edge_type": "data_entity"}, {"from": 56, "to": 16, "label": "ÂåØÂÖ•ÁõÆÊ®ô", "edge_type": "data_entity"}, {"from": 57, "to": 2, "label": "ÈÄöË∑ØË≥áÊñô", "edge_type": "data_entity"}, {"from": 57, "to": 7, "label": "È†ªÈÅìË®≠ÂÆö", "edge_type": "data_entity"}, {"from": 57, "to": 5, "label": "ÁôºÈÄÅÈÄöË∑Ø", "edge_type": "data_entity"}, {"from": 58, "to": 4, "label": "Ê†∏ÂøÉË≥áÊñô", "edge_type": "data_entity"}, {"from": 58, "to": 3, "label": "ÁØ©ÈÅ∏‰æùÊìö", "edge_type": "data_entity"}, {"from": 58, "to": 46, "label": "CDH ÂêåÊ≠•", "edge_type": "data_entity"}, {"from": 59, "to": 5, "label": "Ë®äÊÅØÂÖßÂÆπ", "edge_type": "data_entity"}, {"from": 59, "to": 6, "label": "ÂõûË¶ÜÂÖßÂÆπ", "edge_type": "data_entity"}, {"from": 59, "to": 13, "label": "ÁØÑÊú¨‰æÜÊ∫ê", "edge_type": "data_entity"}, {"from": 59, "to": 7, "label": "Journey Ë®äÊÅØ", "edge_type": "data_entity"}, {"from": 60, "to": 31, "label": "Ëß∏Áôº‰∫ã‰ª∂", "edge_type": "data_entity"}, {"from": 60, "to": 18, "label": "ÁãÄÊÖã‰∫ã‰ª∂", "edge_type": "data_entity"}, {"from": 60, "to": 6, "label": "Ë®äÊÅØ‰∫ã‰ª∂", "edge_type": "data_entity"}, {"from": 60, "to": 48, "label": "Webhook", "edge_type": "data_entity"}]};

// COLOR PALETTE (Vibrant on Dark)
const COLORS = {
  platform:   { bg: '#A371F7', border: '#A371F7' }, // Purple
  module:     { bg: '#58A6FF', border: '#58A6FF' }, // Blue
  subfeature: { bg: '#3FB950', border: '#3FB950' }, // Green
  infra:      { bg: '#D29922', border: '#D29922' }, // Orange
  data:       { bg: '#F778BA', border: '#F778BA' }, // Pink
};

// 1. Process Nodes (Circles with Text Inside)
const nodes = RAW_DATA.nodes.map(n => {
  const c = COLORS[n.group] || COLORS.module;
  const size = n.size < 30 ? 35 : n.size; // Ensure minimum size for text
  
  return {
    id: n.id,
    label: n.label, // Vis.js handles \n automatically
    group: n.group,
    title: n.title,
    shape: 'circle', // Circle shape
    widthConstraint: { minimum: size, maximum: size + 30 }, // Force circle size
    color: {
      background: c.bg,
      border: c.border,
      highlight: { background: '#fff', border: '#fff' },
      hover: { background: '#fff', border: '#fff' }
    },
    font: {
      color: '#000000', // Black text for contrast
      size: 12,
      face: 'Segoe UI, sans-serif',
      bold: true,
      multi: true
    },
    borderWidth: 2,
    margin: 10,
    shadow: { enabled: true, color: 'rgba(0,0,0,0.5)', size: 10 }
  };
});

// 2. Process Edges (Straight lines with labels)
const edges = RAW_DATA.edges.map((e, i) => {
  const isContains = e.edge_type === 'hierarchy' || e.edge_type === 'contains';
  return {
    id: i, from: e.from, to: e.to,
    label: isContains ? '' : (e.label || ''),
    color: { color: isContains ? '#30363d' : '#8b949e', opacity: isContains ? 0.4 : 0.8 },
    arrows: isContains ? '' : 'to',
    width: isContains ? 1 : 1.5,
    font: { size: 10, color: '#8b949e', background: '#0d1117', strokeWidth: 0, align: 'middle' },
    smooth: { type: 'continuous' } // Straighter lines
  };
});

// 3. Init Network
const container = document.getElementById('graph-container');
const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
const options = {
  physics: {
    forceAtlas2Based: {
      gravitationalConstant: -120,
      centralGravity: 0.01,
      springLength: 180,
      springConstant: 0.08,
      damping: 0.4
    },
    maxVelocity: 50,
    solver: 'forceAtlas2Based',
    timestep: 0.35,
    stabilization: { iterations: 150 }
  },
  interaction: { hover: true, tooltipDelay: 200, hideEdgesOnDrag: true },
  layout: { improvedLayout: true }
};
const network = new vis.Network(container, data, options);

// 4. Interaction
network.on('click', p => {
  if (p.nodes.length) {
    const nid = p.nodes[0];
    showDetail(nid);
  } else {
    document.getElementById('detail-panel').classList.remove('open');
  }
});

function showDetail(nid) {
  const n = data.nodes.get(nid);
  const c = COLORS[n.group] || COLORS.module;
  
  // ANALYZE CONNECTIONS
  const conns = network.getConnectedEdges(nid).map(eid => {
    const e = data.edges.get(eid);
    const isSrc = e.from === nid;
    const neighbor = data.nodes.get(isSrc ? e.to : e.from);
    return { 
      name: neighbor.label.replace('\\n',' '), 
      type: e.label, 
      dir: isSrc ? 'out' : 'in', 
      id: neighbor.id,
      group: neighbor.group
    };
  });

  const incoming = conns.filter(x => x.dir === 'in');
  const outgoing = conns.filter(x => x.dir === 'out');
  
  // DETERMINE ROLE
  let role = "Standard Node";
  if (outgoing.length > 5) role = "Core Provider";
  else if (incoming.length > 5) role = "Major Consumer";
  else if (outgoing.length === 0 && incoming.length > 0) role = "Leaf Feature";
  else if (n.group === 'infra') role = "Infrastructure";

  // RISK ASSESSMENT
  let riskLevel = "Low";
  let riskMsg = "";
  if (outgoing.length > 8) {
    riskLevel = "Critical";
    riskMsg = `High Impact: Modifications affect ${outgoing.length} downstream components.`;
  } else if (outgoing.length > 3) {
    riskLevel = "Medium";
    riskMsg = `Moderate Impact: Affects ${outgoing.length} components.`;
  }

  const html = `
    <div class="panel-header">
      <div class="panel-badges">
        <span class="badge" style="background:${c.bg}">${n.group}</span>
        <span class="badge" style="background:#333;color:#fff;border:1px solid #555">${role}</span>
      </div>
      <div class="panel-title">${n.label.replace('\\n',' ')}</div>
    </div>

    <div class="panel-tabs">
      <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
      <button class="tab-btn" onclick="switchTab('flow')">Data Flow</button>
    </div>

    <div class="panel-body">
      
      <!-- OVERVIEW TAB -->
      <div id="tab-overview" class="tab-content active">
        ${riskMsg ? `<div class="risk-alert"><span>‚ö†Ô∏è</span> <div><strong>${riskLevel} Risk</strong><br>${riskMsg}</div></div>` : ''}
        
        <div class="section-title">Functional Definition</div>
        <div class="def-box">
          <div class="def-text">${n.title || 'No definition available.'}</div>
        </div>

        <div class="section-title">Connectivity Metrics</div>
        <div class="metrics-grid">
          <div class="metric-card">
            <span class="metric-val" style="color:#58a6ff">${incoming.length}</span>
            <span class="metric-label">Dependencies</span>
          </div>
          <div class="metric-card">
            <span class="metric-val" style="color:#ff9f0a">${outgoing.length}</span>
            <span class="metric-label">Downstream Impacts</span>
          </div>
        </div>
      </div>

      <!-- FLOW TAB -->
      <div id="tab-flow" class="tab-content">
        
        <div class="flow-group">
          <div class="flow-header">
            <span style="color:#58a6ff">‚Üô</span> Incoming (Dependencies) <span class="flow-count">${incoming.length}</span>
          </div>
          ${incoming.length ? incoming.map(cn => `
            <div class="rel-item" onclick="network.focus(${cn.id}, {scale:1.5, animation:true}); showDetail(${cn.id})">
              <span class="rel-dir" style="color:#58a6ff">IN</span>
              <span class="rel-name">${cn.name}</span>
              <span class="rel-tag">${cn.type || 'use'}</span>
            </div>
          `).join('') : '<div style="font-size:12px;color:#666;padding:8px">No dependencies.</div>'}
        </div>

        <div class="flow-group">
          <div class="flow-header">
            <span style="color:#ff9f0a">‚Üó</span> Outgoing (Impacts) <span class="flow-count">${outgoing.length}</span>
          </div>
          ${outgoing.length ? outgoing.map(cn => `
            <div class="rel-item" onclick="network.focus(${cn.id}, {scale:1.5, animation:true}); showDetail(${cn.id})">
              <span class="rel-dir" style="color:#ff9f0a">OUT</span>
              <span class="rel-name">${cn.name}</span>
              <span class="rel-tag">${cn.type || 'impacts'}</span>
            </div>
          `).join('') : '<div style="font-size:12px;color:#666;padding:8px">No downstream impact.</div>'}
        </div>

      </div>

      <button class="action-btn btn-impact" style="width:100%;margin-top:20px" onclick="enterImpact(${nid})">‚ö° Run Full Impact Analysis</button>
    </div>
  `;
  document.getElementById('detail-content').innerHTML = html;
  document.getElementById('detail-panel').classList.add('open');
}

window.switchTab = function(tabName) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById('tab-' + tabName).classList.add('active');
}

// Search
document.getElementById('search').addEventListener('input', e => {
  const val = e.target.value.toLowerCase();
  const matches = data.nodes.get().filter(n => n.label.toLowerCase().includes(val));
  const ids = matches.map(n => n.id);
  data.nodes.forEach(n => {
    data.nodes.update({ id: n.id, opacity: ids.length && !ids.includes(n.id) ? 0.1 : 1 });
  });
});

// Filter
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    const grp = e.target.dataset.filter;
    data.nodes.forEach(n => {
      const visible = grp === 'all' || n.group === grp || n.group === 'platform';
      data.nodes.update({ id: n.id, opacity: visible ? 1 : 0.05 });
    });
  });
});

</script>
</body>
</html>