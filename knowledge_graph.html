<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAAC Knowledge Graph (Dark)</title>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
  :root {
    --bg-color: #121212;
    --panel-bg: rgba(30, 30, 30, 0.9);
    --text-primary: #E0E0E0;
    --text-secondary: #A0A0A0;
    --border-color: rgba(255, 255, 255, 0.1);
    
    /* Neon Colors from Reference */
    --c-platform: #8A2BE2; /* Violet */
    --c-module: #4B0082;   /* Indigo/Purple */
    --c-feature: #2E8B57;  /* Sea Green */
    --c-infra: #DAA520;    /* Goldenrod */
    --c-data: #4682B4;     /* Steel Blue */
  }
  
  * { margin:0; padding:0; box-sizing:border-box; outline:none; -webkit-font-smoothing: antialiased; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg-color);
    color: var(--text-primary);
    overflow: hidden;
  }

  #graph-container { width:100vw; height:100vh; background: #121212; }

  /* --- UI CONTROLS --- */
  .floating-panel {
    position: fixed; z-index: 100;
    background: var(--panel-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    border-radius: 12px;
    transition: all 0.3s ease;
  }

  /* TOP BAR */
  #top-bar {
    top: 20px; left: 20px; right: 20px;
    padding: 12px 20px;
    display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
    max-width: 1600px; margin: 0 auto;
  }
  
  .app-title { font-weight: 700; color: #fff; display: flex; align-items: center; gap: 8px; font-size: 16px; }
  .app-title span { color: var(--text-secondary); font-weight: 400; font-size: 12px; border: 1px solid var(--border-color); padding: 2px 8px; border-radius: 4px; }

  /* Search */
  .search-wrapper { position: relative; flex: 1; max-width: 300px; }
  .search-wrapper input {
    width: 100%; padding: 8px 12px 8px 36px;
    border-radius: 8px; border: 1px solid var(--border-color);
    background: rgba(0,0,0,0.3); color: #fff;
    font-size: 13px;
  }
  .search-wrapper input:focus { border-color: #fff; }
  .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); opacity: 0.5; }

  /* Filters */
  .filter-group { display: flex; gap: 6px; }
  .filter-btn {
    border: 1px solid var(--border-color); background: rgba(255,255,255,0.05); 
    padding: 6px 12px; border-radius: 6px; font-size: 12px; color: var(--text-secondary);
    cursor: pointer; transition: all 0.2s;
  }
  .filter-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
  .filter-btn.active { background: #fff; color: #000; font-weight: 600; }

  /* Actions */
  .action-btn {
    padding: 8px 16px; border-radius: 20px; border: none;
    font-size: 12px; font-weight: 600; cursor: pointer;
    background: #fff; color: #000;
  }
  .action-btn:hover { background: #e0e0e0; }
  .btn-impact { background: #FF453A; color: #fff; }
  .btn-impact:hover { background: #FF6961; }

  /* LEGEND */
  #legend {
    bottom: 24px; left: 24px; padding: 16px;
    width: 180px;
  }
  .legend-title { font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 8px; }
  .legend-row { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; font-size: 12px; color: var(--text-primary); }
  .circle { width: 12px; height: 12px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); }

  /* DETAIL PANEL */
  #detail-panel {
    top: 80px; right: 24px; bottom: 24px; width: 360px;
    transform: translateX(120%); padding: 0; display: flex; flex-direction: column;
  }
  #detail-panel.open { transform: translateX(0); }
  
  .panel-header { padding: 20px; border-bottom: 1px solid var(--border-color); }
  .panel-title { font-size: 20px; font-weight: 700; color: #fff; margin-bottom: 4px; }
  .panel-badge { font-size: 11px; padding: 2px 8px; border-radius: 4px; display: inline-block; font-weight: 600; }
  
  .panel-body { flex: 1; overflow-y: auto; padding: 20px; }
  .panel-desc { font-size: 14px; line-height: 1.5; color: #ccc; margin-bottom: 20px; }
  
  .rel-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px; border-radius: 8px; margin-bottom: 4px;
    background: rgba(255,255,255,0.05); cursor: pointer; border: 1px solid transparent;
  }
  .rel-item:hover { border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); }
  .rel-type { font-size: 10px; padding: 2px 6px; background: rgba(255,255,255,0.1); border-radius: 4px; color: #aaa; }

  /* IMPACT UI */
  #impact-banner {
    top: 90px; left: 50%; transform: translateX(-50%);
    background: #FF453A; color: white; padding: 8px 24px; border-radius: 30px;
    display: none; align-items: center; gap: 12px; font-weight: 600; font-size: 13px;
    box-shadow: 0 0 20px rgba(255, 69, 58, 0.4);
  }
  #impact-banner.show { display: flex; }

  #impact-list {
    bottom: 24px; right: 400px; width: 240px; max-height: 400px; overflow-y: auto;
    display: none;
  }
  #impact-list.show { display: block; }
  .impact-row { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid var(--border-color); color: #fff; cursor: pointer; }
  .impact-row:hover { background: rgba(255,255,255,0.1); }
  .depth-tag { background: #FF453A; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-right: 8px; }

</style>
</head>
<body>

<div id="top-bar" class="floating-panel">
  <div class="app-title">MAAC <span>Knowledge Graph</span></div>
  
  <div class="search-wrapper">
    <span class="search-icon">üîç</span>
    <input type="text" id="search" placeholder="Search...">
  </div>

  <div class="filter-group">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="module">Modules</button>
    <button class="filter-btn" data-filter="subfeature">Features</button>
    <button class="filter-btn" data-filter="infra">Infra</button>
    <button class="filter-btn" data-filter="data">Data</button>
  </div>
  
  <div style="flex:1"></div>
  <button class="action-btn btn-impact" id="impact-btn">‚ö° Impact Analysis</button>
  <button class="action-btn" onclick="resetView()" style="background:transparent;color:#aaa;border:1px solid #aaa">Reset</button>
</div>

<div id="graph-container"></div>

<div id="impact-banner" class="floating-panel">
  <span>Analysis Mode</span>
  <span style="opacity:0.5">|</span>
  <span id="impact-msg">Select a node</span>
  <button onclick="exitImpact()" style="background:rgba(0,0,0,0.2);border:none;color:#fff;border-radius:12px;padding:2px 8px;font-size:11px;cursor:pointer">Exit</button>
</div>

<div id="impact-list" class="floating-panel">
  <div style="padding:12px; border-bottom:1px solid var(--border-color); color:#FF453A; font-weight:700">Affected Nodes</div>
  <div id="impact-content"></div>
</div>

<div id="legend" class="floating-panel">
  <div class="legend-title">Nodes</div>
  <div class="legend-row"><div class="circle" style="background:#BD93F9;border-color:#BD93F9"></div> Platform</div>
  <div class="legend-row"><div class="circle" style="background:#8BE9FD;border-color:#8BE9FD"></div> Module</div>
  <div class="legend-row"><div class="circle" style="background:#50FA7B;border-color:#50FA7B"></div> Feature</div>
  <div class="legend-row"><div class="circle" style="background:#FFB86C;border-color:#FFB86C"></div> Infra</div>
  <div class="legend-row"><div class="circle" style="background:#FF79C6;border-color:#FF79C6"></div> Data</div>
  <div style="margin-top:12px" class="legend-title">Edges</div>
  <div class="legend-row"><div style="width:20px;height:1px;background:#fff"></div> Relationship</div>
</div>

<div id="detail-panel" class="floating-panel">
  <button onclick="closeDetail()" style="position:absolute;top:16px;right:16px;background:none;border:none;color:#fff;font-size:20px;cursor:pointer">√ó</button>
  <div id="detail-content"></div>
</div>

<script>
const RAW_DATA = {"nodes": [{"id": 1, "label": "MAAC Platform", "group": "platform", "title": "Marketing Automation & Analytics Center\nCrescendo Lab's core product platform", "size": 50}, {"id": 2, "label": "Contact\nManagement", "group": "module", "title": "ËÅØÁµ°‰∫∫ÁÆ°ÁêÜÊ†∏ÂøÉ\nÁÆ°ÁêÜÊâÄÊúâÈÄöË∑ØÁöÑËÅØÁµ°‰∫∫Ë≥áÊñô\nÂåÖÂê´ LINE / FB / IG / Phone / Email", "size": 40}, {"id": 3, "label": "Segment", "group": "module", "title": "ÂàÜÁúæÂºïÊìé\nÊ†πÊìöÊ¢ù‰ª∂ÁØ©ÈÅ∏ËÅØÁµ°‰∫∫Áæ§ÁµÑ\nÊîØÊè¥ÈùúÊÖã/ÂãïÊÖãÂàÜÁúæ", "size": 36}, {"id": 4, "label": "Tag\nManager", "group": "module", "title": "Ê®ôÁ±§Á≥ªÁµ±\nTag CRUD„ÄÅËá™ÂãïÂä†Ê®ô„ÄÅÊ®ôÁ±§ÂàÜÊûê", "size": 34}, {"id": 5, "label": "Broadcast", "group": "module", "title": "Êé®Êí≠‰∏≠ÂøÉ\nÊéíÁ®ãÊé®Êí≠„ÄÅA/B Ê∏¨Ë©¶„ÄÅÂ§öÈÄöË∑ØÁôºÈÄÅ", "size": 38}, {"id": 6, "label": "Auto-reply", "group": "module", "title": "Ëá™ÂãïÂõûË¶Ü\nÈóúÈçµÂ≠óËß∏Áôº„ÄÅÊôÇÈñìÈôêÂà∂„ÄÅÈáçË§áÊéßÂà∂", "size": 34}, {"id": 7, "label": "Customer\nJourney", "group": "module", "title": "Ëá™ÂãïÂåñÊóÖÁ®ã\nÂ§öÊ≠•È©üËá™ÂãïÂåñÊµÅÁ®ã„ÄÅËß∏ÁôºÂô®„ÄÅÂãï‰ΩúÁØÄÈªû\nÂåÖÂê´ EDM Êï¥Âêà", "size": 42}, {"id": 8, "label": "Rich Menu", "group": "module", "title": "LINE ÂúñÊñáÈÅ∏ÂñÆ\nÊéíÁ®ã„ÄÅÂàÜÁúæÈ°ØÁ§∫„ÄÅÈÄ£ÁµêÁÆ°ÁêÜ", "size": 30}, {"id": 9, "label": "Insight\n& Reports", "group": "module", "title": "Êï∏ÊìöÂàÜÊûê\nTag Ë¶ÜËìãÁéá„ÄÅÁç≤ÂÆ¢ÊºèÊñó„ÄÅË®äÊÅØÁµ±Ë®à\nÊØèÊó•/ÊØèÈÄ±Â†±Ë°®", "size": 38}, {"id": 10, "label": "Deeplink", "group": "module", "title": "Ê∑±Â∫¶ÈÄ£Áµê\nUTM ËøΩËπ§„ÄÅÁç≤ÂÆ¢‰æÜÊ∫êÊ≠∏Âõ†", "size": 30}, {"id": 11, "label": "Tracelink", "group": "module", "title": "ÈÄ£ÁµêËøΩËπ§\nÈªûÊìäÂàÜÊûê„ÄÅËΩâÊèõËøΩËπ§", "size": 28}, {"id": 12, "label": "Prize\nManagement", "group": "module", "title": "ÁçéÂìÅÁÆ°ÁêÜ\nÁçéÂìÅÊ±†„ÄÅÂÖåÊèõÁ¢º„ÄÅÊäΩÁçéÁ≥ªÁµ±", "size": 28}, {"id": 13, "label": "Template\nLibrary", "group": "module", "title": "ÁØÑÊú¨Â∫´\nË®äÊÅØÁØÑÊú¨„ÄÅÂèØÈáçÁî®ÂÖßÂÆπÂçÄÂ°ä", "size": 26}, {"id": 14, "label": "Contact\nProfile", "group": "subfeature", "title": "ËÅØÁµ°‰∫∫Ê™îÊ°à\nÂßìÂêç„ÄÅÈõªË©±„ÄÅEmail„ÄÅËá™Ë®ÇÊ¨Ñ‰Ωç\nÂç≥ÊôÇÁ∑®ËºØËàáÂêåÊ≠•", "size": 18}, {"id": 15, "label": "Profile\nUnification", "group": "subfeature", "title": "Ë∑®ÈÄöË∑ØÂêà‰Ωµ\nLINE + SMS + Email Âêà‰ΩµÁÇ∫ÂñÆ‰∏ÄËÅØÁµ°‰∫∫\nÂêà‰ΩµÊ¨äÈáçÈÇèËºØ„ÄÅÊ¨Ñ‰ΩçË¶ÜÂØ´ÂÑ™ÂÖàÈ†ÜÂ∫è", "size": 22}, {"id": 16, "label": "Contact\nImport", "group": "subfeature", "title": "ËÅØÁµ°‰∫∫ÂåØÂÖ•\nCSV / API ÂåØÂÖ•„ÄÅKey Value ÂåπÈÖç\nÊîØÊè¥ line_uid / customer_id / phone / email", "size": 18}, {"id": 17, "label": "UID\nBinding", "group": "subfeature", "title": "Ë∫´‰ªΩÁ∂ÅÂÆö\nline_uid ‚Üî customer_id Â∞çÊáâ\nBindlink ÂõûÂëº„ÄÅCID Á∂ÅÂÆöÈÇèËºØ", "size": 18}, {"id": 18, "label": "Friend\nStatus", "group": "subfeature", "title": "LINE Â•ΩÂèãÁãÄÊÖã\nAuth / Following / Blocked\nÊ†πÊìö Webhook ‰∫ã‰ª∂ËøΩËπ§", "size": 16}, {"id": 19, "label": "Display\nName", "group": "subfeature", "title": "È°ØÁ§∫ÂêçÁ®±ÈÇèËºØ\ndisplay_name vs original_name\n‰æùË≥¥ LINE Channel Token ÂêåÊ≠•", "size": 16}, {"id": 20, "label": "Contact\nFields", "group": "subfeature", "title": "ËÅØÁµ°‰∫∫Ê¨Ñ‰Ωç\nname, phone, email, customer_id,\ntags, custom fields\nÊ¨Ñ‰ΩçÊõ¥Êñ∞Ë¶èÂâáÔºöÊúâÂÄºË¶ÜÂØ´„ÄÅÁ©∫ÂÄº‰øùÁïô", "size": 18}, {"id": 21, "label": "Filter\nConditions", "group": "subfeature", "title": "ÁØ©ÈÅ∏Ê¢ù‰ª∂ÂºïÊìé\nAND / OR ÈÇèËºØ„ÄÅTag ÁØ©ÈÅ∏\nÊó•Êúü„ÄÅ‰∫íÂãï„ÄÅ‰æÜÊ∫êÁ≠âÂ§öÈáçÊ¢ù‰ª∂", "size": 18}, {"id": 22, "label": "Dynamic\nSegment", "group": "subfeature", "title": "ÂãïÊÖãÂàÜÁúæ\nÊ¢ù‰ª∂ËÆäÊõ¥ÊôÇËá™ÂãïÊõ¥Êñ∞ÊàêÂì°\nËÉåÊôØÊéíÁ®ãË®àÁÆó", "size": 16}, {"id": 23, "label": "Tag\nCRUD", "group": "subfeature", "title": "Ê®ôÁ±§ÁÆ°ÁêÜ\nÂª∫Á´ã„ÄÅÁ∑®ËºØ„ÄÅÂà™Èô§Ê®ôÁ±§\nÊ®ôÁ±§ÂêçÁ®±„ÄÅÊéíÂ∫è", "size": 16}, {"id": 24, "label": "Auto-tag\nRules", "group": "subfeature", "title": "Ëá™ÂãïÂä†Ê®ôË¶èÂâá\n‰æù‰∫ã‰ª∂/Ë°åÁÇ∫Ëá™ÂãïÊ®ôË®òËÅØÁµ°‰∫∫", "size": 16}, {"id": 25, "label": "Message\nSend", "group": "subfeature", "title": "Ë®äÊÅØÁôºÈÄÅÂºïÊìé\nÊéíÁ®ãÁôºÈÄÅ„ÄÅÂç≥ÊôÇÁôºÈÄÅ\nÂ§öÈÄöË∑ØÔºàLINE / SMS / EmailÔºâ", "size": 18}, {"id": 26, "label": "A/B\nTesting", "group": "subfeature", "title": "A/B Ê∏¨Ë©¶\nÂ§öÁâàÊú¨Ë®äÊÅØÊØîËºÉ\nËá™ÂãïÈÅ∏ÊìáÊúÄ‰Ω≥ÁâàÊú¨", "size": 14}, {"id": 27, "label": "Audience\nTargeting", "group": "subfeature", "title": "ÂèóÁúæË®≠ÂÆö\n‰æù Segment ÈÅ∏ÊìáÊé®Êí≠Â∞çË±°", "size": 16}, {"id": 28, "label": "Keyword\nMatching", "group": "subfeature", "title": "ÈóúÈçµÂ≠óÊØîÂ∞ç\nÂÆåÂÖ®/ÈÉ®ÂàÜÂåπÈÖç„ÄÅÊ≠£Ââá\nËß∏ÁôºÂÑ™ÂÖàÈ†ÜÂ∫èÈÇèËºØ", "size": 16}, {"id": 29, "label": "Time & Reply\nLimits", "group": "subfeature", "title": "ÊôÇÈñì & Ê¨°Êï∏ÈôêÂà∂\nÂÜ∑ÂçªÊôÇÈñì„ÄÅÊØè‰∫∫ÊúÄÂ§ßÂõûË¶ÜÊ¨°Êï∏\nÈáçË§áË®äÊÅØÊéßÂà∂", "size": 16}, {"id": 30, "label": "Channel\nRestrictions", "group": "subfeature", "title": "ÈÄöË∑ØÈôêÂà∂\nMeta (FB/IG) ‰∏çÊîØÊè¥Êñ∞Â•ΩÂèãÈóúÈçµÂ≠óÂõûË¶Ü\nLINE / WhatsApp ÊîØÊè¥", "size": 14}, {"id": 31, "label": "Trigger\nEngine", "group": "subfeature", "title": "Ëß∏ÁôºÂºïÊìé\nEvent-BasedÔºöWebhook ‰∫ã‰ª∂È©ÖÂãï\nTime-BasedÔºöÊéíÁ®ãËß∏Áôº (Airflow)", "size": 20}, {"id": 32, "label": "Action\nNodes", "group": "subfeature", "title": "Âãï‰ΩúÁØÄÈªû\nSend Message / Add Tag / Wait\nCondition Split / A/B Split", "size": 20}, {"id": 33, "label": "EDM / Email\nAction", "group": "subfeature", "title": "Email ÁôºÈÄÅÁØÄÈªû\nMAAC ‚Üí Epistola ‚Üí SendGrid\nToken Exchange / iframe Á∑®ËºØÂô®", "size": 18}, {"id": 34, "label": "Member\nProgress", "group": "subfeature", "title": "ÊàêÂì°ÈÄ≤Â∫¶ËøΩËπ§\nREADY ‚Üí RUNNING ‚Üí WAITING ‚Üí ENDED\nÁãÄÊÖãÊ©üÁÆ°ÁêÜ", "size": 16}, {"id": 35, "label": "Node\nPerformance", "group": "subfeature", "title": "ÁØÄÈªûÁ∏æÊïàÊåáÊ®ô\nÊØèÁØÄÈªû send/open/click Áéá\nJourney Êï¥È´îËΩâÊèõÊºèÊñó", "size": 16}, {"id": 36, "label": "Tag\nCoverage", "group": "subfeature", "title": "Ê®ôÁ±§Ë¶ÜËìãÁéá\nÂÖ®ÂìÅÁâåÊ®ôÁ±§‰ΩøÁî®Áµ±Ë®à\n‰æùË≥¥ Airflow Êó•Â†±Ë°®", "size": 16}, {"id": 37, "label": "Acquisition\nFunnel", "group": "subfeature", "title": "Áç≤ÂÆ¢ÊºèÊñó\nÊñ∞ËÅØÁµ°‰∫∫‰æÜÊ∫ê„ÄÅËΩâÊèõÁéá\nDeeplink Â†±Ë°®", "size": 16}, {"id": 38, "label": "Message\nAnalytics", "group": "subfeature", "title": "Ë®äÊÅØÁµ±Ë®à\nÊé®Êí≠ÊàêÊïà„ÄÅÈñã‰ø°Áéá„ÄÅÈªûÊìäÁéá\nËá™ÂãïÂõûË¶ÜÊéíÂêç", "size": 16}, {"id": 39, "label": "Weekly\nReport", "group": "subfeature", "title": "ÊØèÈÄ±Â†±Ë°®\nËá™ÂãïÂØÑÈÄÅÁµ¶ÂÆ¢Êà∂\n‰æùË≥¥ Airflow ÊéíÁ®ã", "size": 14}, {"id": 40, "label": "UTM\nTracking", "group": "subfeature", "title": "UTM ÂèÉÊï∏ËøΩËπ§\n‰æÜÊ∫ê„ÄÅÂ™í‰ªã„ÄÅÊ¥ªÂãïÊ≠∏Âõ†", "size": 14}, {"id": 41, "label": "Acquisition\nSource", "group": "subfeature", "title": "Áç≤ÂÆ¢‰æÜÊ∫êËøΩËπ§\nÊñ∞ËÅØÁµ°‰∫∫Ê≠∏Âõ†Âà∞ Deeplink", "size": 14}, {"id": 42, "label": "Menu\nScheduling", "group": "subfeature", "title": "ÊéíÁ®ãÁÆ°ÁêÜ\nÊåâÊôÇÈñìÂàáÊèõ‰∏çÂêåÈÅ∏ÂñÆ", "size": 14}, {"id": 43, "label": "Per-audience\nMenu", "group": "subfeature", "title": "ÂàÜÁúæÈÅ∏ÂñÆ\n‰æùÊ®ôÁ±§/ÂàÜÁæ§È°ØÁ§∫‰∏çÂêåÈÅ∏ÂñÆ", "size": 14}, {"id": 44, "label": "Sender\nDomain", "group": "subfeature", "title": "Sender Domain ÁÆ°ÁêÜ\nDNS È©óË≠âÔºöCNAME / DKIM1 / DKIM2 / DMARC\nÈÄèÈÅé SendGrid API È©óË≠â", "size": 16}, {"id": 45, "label": "Channel\nStatus", "group": "subfeature", "title": "Email È†ªÈÅìÁãÄÊÖã\nnot_set ‚Üí connected ‚Üí warning ‚Üí suspended\nHard Bounce > 2% Êàñ Spam > 0.3% ‚Üí warning", "size": 16}, {"id": 46, "label": "CDH", "group": "infra", "title": "Customer Data Hub\nÁµ±‰∏ÄÂÆ¢Êà∂Ë≥áÊñô‰∏≠ÂøÉ\nË∑® MAAC / CAAC ÂêåÊ≠•ËÅØÁµ°‰∫∫", "size": 28}, {"id": 47, "label": "CAAC", "group": "infra", "title": "Conversational Analytics\n& Automation Center\nÂÆ¢ÊúçÂ∞çË©±Âπ≥Âè∞", "size": 24}, {"id": 48, "label": "LINE\nAPI", "group": "infra", "title": "LINE Messaging API\nWebhook„ÄÅPush/Reply Message\nProfile Sync„ÄÅFriend Status", "size": 26}, {"id": 49, "label": "Meta\nAPI", "group": "infra", "title": "Facebook + Instagram API\nË®äÊÅØÊî∂Áôº„ÄÅÁî®Êà∂Ë≥áÊñô\nÊúâÊîøÁ≠ñÈôêÂà∂", "size": 22}, {"id": 50, "label": "SendGrid", "group": "infra", "title": "Email ÁôºÈÄÅÊúçÂãô\nSender Domain È©óË≠â\nBounce / Spam Rate Áõ£Êéß", "size": 22}, {"id": 51, "label": "Airflow", "group": "infra", "title": "Ë≥áÊñôÁÆ°Á∑öÊéíÁ®ã\nÊØèÊó•Â†±Ë°® Pipeline\nÊéßÂà∂ Insight Ë≥áÊñôÊõ¥Êñ∞", "size": 22}, {"id": 52, "label": "RabbitMQ", "group": "infra", "title": "Ë®äÊÅØ‰ΩáÂàó\nJourney ‰∫ã‰ª∂ÂàÜÁôº\nWorker ‰ªªÂãôÊéíÁ®ã", "size": 20}, {"id": 53, "label": "Rubato", "group": "infra", "title": "Journey Ê†∏ÂøÉÂºïÊìé\nËß∏ÁôºË©ï‰º∞„ÄÅÁØÄÈªûÂü∑Ë°å\nÈÄ≤Â∫¶ÁÆ°ÁêÜ", "size": 22}, {"id": 54, "label": "Epistola", "group": "infra", "title": "Email Extension Service\niframe Á∑®ËºØÂô®„ÄÅË®äÊÅØ CRUD\nËàá MAAC Journey Êï¥Âêà", "size": 20}, {"id": 55, "label": "Cloud\nLogging", "group": "infra", "title": "GCP Cloud Logging\n‰∫ã‰ª∂Êó•Ë™åÊî∂ÈõÜ\nJourney Ëß∏Áôº‰∫ã‰ª∂‰æÜÊ∫ê", "size": 18}, {"id": 56, "label": "Contact\nEntity", "group": "data", "title": "ËÅØÁµ°‰∫∫Ë≥áÊñôÁâ©‰ª∂\nline_uid, customer_id, phone, email\nname, tags, custom_fields", "size": 22}, {"id": 57, "label": "Channel\nEntity", "group": "data", "title": "È†ªÈÅìÂØ¶È´î\nLINE / Email / SMS / WhatsApp / FB / IG\nchannel_id, status, config", "size": 20}, {"id": 58, "label": "Tag\nEntity", "group": "data", "title": "Ê®ôÁ±§Áâ©‰ª∂\ntag_id, name, source (maac/cdh)\nËá™ÂãïÊ®ô / ÊâãÂãïÊ®ô", "size": 18}, {"id": 59, "label": "Message\nEntity", "group": "data", "title": "Ë®äÊÅØÁâ©‰ª∂\nÊé®Êí≠/Ëá™ÂãïÂõûË¶Ü/Journey Ë®äÊÅØ\nÁØÑÊú¨„ÄÅRich Content", "size": 18}, {"id": 60, "label": "Event /\nWebhook", "group": "data", "title": "‰∫ã‰ª∂Áâ©‰ª∂\nLINE Webhook, CDH Event\nFollow / Unfollow / Message / Tag Change", "size": 20}], "edges": [{"from": 1, "to": 2, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 3, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 4, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 5, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 6, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 7, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 8, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 9, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 10, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 11, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 12, "label": "", "edge_type": "hierarchy"}, {"from": 1, "to": 13, "label": "", "edge_type": "hierarchy"}, {"from": 2, "to": 14, "label": "", "edge_type": "contains"}, {"from": 2, "to": 15, "label": "", "edge_type": "contains"}, {"from": 2, "to": 16, "label": "", "edge_type": "contains"}, {"from": 2, "to": 17, "label": "", "edge_type": "contains"}, {"from": 2, "to": 18, "label": "", "edge_type": "contains"}, {"from": 2, "to": 19, "label": "", "edge_type": "contains"}, {"from": 2, "to": 20, "label": "", "edge_type": "contains"}, {"from": 3, "to": 21, "label": "", "edge_type": "contains"}, {"from": 3, "to": 22, "label": "", "edge_type": "contains"}, {"from": 4, "to": 23, "label": "", "edge_type": "contains"}, {"from": 4, "to": 24, "label": "", "edge_type": "contains"}, {"from": 5, "to": 25, "label": "", "edge_type": "contains"}, {"from": 5, "to": 26, "label": "", "edge_type": "contains"}, {"from": 5, "to": 27, "label": "", "edge_type": "contains"}, {"from": 6, "to": 28, "label": "", "edge_type": "contains"}, {"from": 6, "to": 29, "label": "", "edge_type": "contains"}, {"from": 6, "to": 30, "label": "", "edge_type": "contains"}, {"from": 7, "to": 31, "label": "", "edge_type": "contains"}, {"from": 7, "to": 32, "label": "", "edge_type": "contains"}, {"from": 7, "to": 33, "label": "", "edge_type": "contains"}, {"from": 7, "to": 34, "label": "", "edge_type": "contains"}, {"from": 7, "to": 35, "label": "", "edge_type": "contains"}, {"from": 9, "to": 36, "label": "", "edge_type": "contains"}, {"from": 9, "to": 37, "label": "", "edge_type": "contains"}, {"from": 9, "to": 38, "label": "", "edge_type": "contains"}, {"from": 9, "to": 39, "label": "", "edge_type": "contains"}, {"from": 10, "to": 40, "label": "", "edge_type": "contains"}, {"from": 10, "to": 41, "label": "", "edge_type": "contains"}, {"from": 8, "to": 42, "label": "", "edge_type": "contains"}, {"from": 8, "to": 43, "label": "", "edge_type": "contains"}, {"from": 7, "to": 44, "label": "", "edge_type": "contains"}, {"from": 7, "to": 45, "label": "", "edge_type": "contains"}, {"from": 2, "to": 3, "label": "Êèê‰æõËÅØÁµ°‰∫∫", "edge_type": "data_flow"}, {"from": 2, "to": 5, "label": "Êé®Êí≠Â∞çË±°", "edge_type": "data_flow"}, {"from": 2, "to": 7, "label": "ÊóÖÁ®ãÊàêÂì°", "edge_type": "data_flow"}, {"from": 2, "to": 6, "label": "ÂõûË¶ÜÂ∞çË±°", "edge_type": "data_flow"}, {"from": 2, "to": 8, "label": "ÈÅ∏ÂñÆÂ∞çË±°", "edge_type": "data_flow"}, {"from": 2, "to": 9, "label": "Êï∏Êìö‰æÜÊ∫ê", "edge_type": "data_flow"}, {"from": 3, "to": 5, "label": "ÂèóÁúæÁØ©ÈÅ∏", "edge_type": "data_flow"}, {"from": 3, "to": 7, "label": "ÂÖ•Âè£Ê¢ù‰ª∂", "edge_type": "data_flow"}, {"from": 3, "to": 8, "label": "ÂàÜÁúæÈ°ØÁ§∫", "edge_type": "data_flow"}, {"from": 4, "to": 3, "label": "ÁØ©ÈÅ∏Ê¢ù‰ª∂", "edge_type": "data_flow"}, {"from": 4, "to": 2, "label": "Ê®ôË®òËÅØÁµ°‰∫∫", "edge_type": "data_flow"}, {"from": 4, "to": 8, "label": "ÈÅ∏ÂñÆÂàÜÁæ§‰æùÊìö", "edge_type": "data_flow"}, {"from": 4, "to": 7, "label": "Ëß∏Áôº/Âãï‰ΩúÊ¢ù‰ª∂", "edge_type": "data_flow"}, {"from": 4, "to": 9, "label": "Ë¶ÜËìãÁéáÁµ±Ë®à", "edge_type": "data_flow"}, {"from": 5, "to": 9, "label": "Êé®Êí≠ÊàêÊïà", "edge_type": "data_flow"}, {"from": 5, "to": 13, "label": "‰ΩøÁî®ÁØÑÊú¨", "edge_type": "data_flow"}, {"from": 27, "to": 3, "label": "ËÆÄÂèñÂàÜÁúæ", "edge_type": "data_flow"}, {"from": 6, "to": 4, "label": "Ëß∏ÁôºËá™ÂãïÂä†Ê®ô", "edge_type": "data_flow"}, {"from": 6, "to": 9, "label": "ÂõûË¶ÜÁµ±Ë®à", "edge_type": "data_flow"}, {"from": 7, "to": 5, "label": "Ëß∏ÁôºÊé®Êí≠", "edge_type": "data_flow"}, {"from": 7, "to": 4, "label": "Âä†/ÁßªÈô§Ê®ôÁ±§", "edge_type": "data_flow"}, {"from": 7, "to": 2, "label": "Êõ¥Êñ∞ËÅØÁµ°‰∫∫", "edge_type": "data_flow"}, {"from": 7, "to": 12, "label": "ÁçéÂìÅÁôºÊîæ", "edge_type": "data_flow"}, {"from": 10, "to": 2, "label": "Êñ∞ËÅØÁµ°‰∫∫Ê≠∏Âõ†", "edge_type": "data_flow"}, {"from": 10, "to": 9, "label": "Deeplink Â†±Ë°®", "edge_type": "data_flow"}, {"from": 11, "to": 9, "label": "ÈªûÊìäÂ†±Ë°®", "edge_type": "data_flow"}, {"from": 8, "to": 10, "label": "ÈÅ∏ÂñÆÈÄ£Áµê", "edge_type": "data_flow"}, {"from": 12, "to": 7, "label": "Journey ÁçéÂìÅÁØÄÈªû", "edge_type": "data_flow"}, {"from": 12, "to": 5, "label": "Êé®Êí≠‰∏≠ÁôºÁçé", "edge_type": "data_flow"}, {"from": 48, "to": 2, "label": "Webhook ÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 48, "to": 18, "label": "Â•ΩÂèãÁãÄÊÖã‰∫ã‰ª∂", "edge_type": "infra_dep"}, {"from": 48, "to": 19, "label": "Profile ÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 48, "to": 6, "label": "Êé•Êî∂Ë®äÊÅØ", "edge_type": "infra_dep"}, {"from": 48, "to": 5, "label": "Push Message", "edge_type": "infra_dep"}, {"from": 48, "to": 8, "label": "Rich Menu API", "edge_type": "infra_dep"}, {"from": 49, "to": 6, "label": "FB/IG Ë®äÊÅØ", "edge_type": "infra_dep"}, {"from": 49, "to": 30, "label": "ÊîøÁ≠ñÈôêÂà∂", "edge_type": "infra_dep"}, {"from": 50, "to": 33, "label": "Email ÁôºÈÄÅ", "edge_type": "infra_dep"}, {"from": 50, "to": 44, "label": "DNS È©óË≠â", "edge_type": "infra_dep"}, {"from": 50, "to": 45, "label": "Bounce/Spam Áõ£Êéß", "edge_type": "infra_dep"}, {"from": 51, "to": 9, "label": "Êó•Â†±Ë°® Pipeline", "edge_type": "infra_dep"}, {"from": 51, "to": 36, "label": "Tag Ë¶ÜËìãÁéáË®àÁÆó", "edge_type": "infra_dep"}, {"from": 51, "to": 39, "label": "ÈÄ±Â†±ÊéíÁ®ã", "edge_type": "infra_dep"}, {"from": 51, "to": 31, "label": "Time-Based Ëß∏Áôº", "edge_type": "infra_dep"}, {"from": 46, "to": 15, "label": "Áµ±‰∏Ä Profile", "edge_type": "infra_dep"}, {"from": 46, "to": 4, "label": "CDH Tag ÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 46, "to": 3, "label": "CDH ÂàÜÁúæË¶èÂâá", "edge_type": "infra_dep"}, {"from": 46, "to": 47, "label": "ÈõôÂêëÂêåÊ≠•", "edge_type": "infra_dep"}, {"from": 53, "to": 31, "label": "Ëß∏ÁôºË©ï‰º∞", "edge_type": "infra_dep"}, {"from": 53, "to": 34, "label": "ÈÄ≤Â∫¶ÁÆ°ÁêÜ", "edge_type": "infra_dep"}, {"from": 52, "to": 53, "label": "‰ªªÂãô‰ΩáÂàó", "edge_type": "infra_dep"}, {"from": 55, "to": 53, "label": "‰∫ã‰ª∂Êó•Ë™å", "edge_type": "infra_dep"}, {"from": 54, "to": 33, "label": "Email Á∑®ËºØ/ÁôºÈÄÅ", "edge_type": "infra_dep"}, {"from": 47, "to": 2, "label": "ÂÆ¢ÊúçÂ∞çË©±Ë≥áÊñô", "edge_type": "infra_dep"}, {"from": 56, "to": 2, "label": "Ê†∏ÂøÉË≥áÊñô", "edge_type": "data_entity"}, {"from": 56, "to": 15, "label": "Âêà‰ΩµÂ∞çË±°", "edge_type": "data_entity"}, {"from": 56, "to": 16, "label": "ÂåØÂÖ•ÁõÆÊ®ô", "edge_type": "data_entity"}, {"from": 57, "to": 2, "label": "ÈÄöË∑ØË≥áÊñô", "edge_type": "data_entity"}, {"from": 57, "to": 7, "label": "È†ªÈÅìË®≠ÂÆö", "edge_type": "data_entity"}, {"from": 57, "to": 5, "label": "ÁôºÈÄÅÈÄöË∑Ø", "edge_type": "data_entity"}, {"from": 58, "to": 4, "label": "Ê†∏ÂøÉË≥áÊñô", "edge_type": "data_entity"}, {"from": 58, "to": 3, "label": "ÁØ©ÈÅ∏‰æùÊìö", "edge_type": "data_entity"}, {"from": 58, "to": 46, "label": "CDH ÂêåÊ≠•", "edge_type": "data_entity"}, {"from": 59, "to": 5, "label": "Ë®äÊÅØÂÖßÂÆπ", "edge_type": "data_entity"}, {"from": 59, "to": 6, "label": "ÂõûË¶ÜÂÖßÂÆπ", "edge_type": "data_entity"}, {"from": 59, "to": 13, "label": "ÁØÑÊú¨‰æÜÊ∫ê", "edge_type": "data_entity"}, {"from": 59, "to": 7, "label": "Journey Ë®äÊÅØ", "edge_type": "data_entity"}, {"from": 60, "to": 31, "label": "Ëß∏Áôº‰∫ã‰ª∂", "edge_type": "data_entity"}, {"from": 60, "to": 18, "label": "ÁãÄÊÖã‰∫ã‰ª∂", "edge_type": "data_entity"}, {"from": 60, "to": 6, "label": "Ë®äÊÅØ‰∫ã‰ª∂", "edge_type": "data_entity"}, {"from": 60, "to": 48, "label": "Webhook", "edge_type": "data_entity"}]};

// üé® DARK MODE COLOR PALETTE (Dracula/Neon inspired)
const COLORS = {
  platform:   { bg: '#BD93F9', border: '#BD93F9', font: '#000' }, // Purple
  module:     { bg: '#8BE9FD', border: '#8BE9FD', font: '#000' }, // Cyan
  subfeature: { bg: '#50FA7B', border: '#50FA7B', font: '#000' }, // Green
  infra:      { bg: '#FFB86C', border: '#FFB86C', font: '#000' }, // Orange
  data:       { bg: '#FF79C6', border: '#FF79C6', font: '#000' }, // Pink
};

// üîß EDGE STYLES
const EDGE_COLORS = {
  default: '#6272A4',
  data_flow: '#8BE9FD',
  infra_dep: '#FFB86C',
  contains: '#44475A'
};

// 1. Process Nodes
const nodes = RAW_DATA.nodes.map(n => {
  const style = COLORS[n.group] || COLORS.module;
  
  // Calculate size - Circles need to be big enough for text
  // Base size + length of text factor
  const baseSize = n.group === 'platform' ? 60 : 
                   n.group === 'module' ? 50 : 
                   n.group === 'subfeature' ? 40 : 30;
  
  // Format label: Replace 
 with space for circle packing, or keep 
 for multi-line
  // Vis.js 'circle' puts label inside.
  return {
    id: n.id,
    label: n.label, // Keep original label with 

    group: n.group,
    title: n.title,
    shape: 'circle', // THE KEY: Text inside circle
    widthConstraint: { minimum: baseSize, maximum: baseSize + 20 }, // Force circle size range
    color: {
      background: style.bg,
      border: style.border,
      highlight: { background: '#fff', border: '#fff' },
      hover: { background: '#fff', border: '#fff' }
    },
    font: {
      color: '#000000', // Black text inside bright circles
      size: n.group === 'infra' ? 10 : 12, // Smaller font for small nodes
      face: 'Segoe UI, sans-serif',
      multi: 'html',
      bold: n.group === 'module' || n.group === 'platform'
    },
    borderWidth: 2,
    shadow: { enabled: true, color: 'rgba(0,0,0,0.5)', size: 10 },
    margin: 10,
    
    // Store for reset
    _orig: style
  };
});

// 2. Process Edges
const edges = RAW_DATA.edges.map((e, i) => {
  const isContains = e.edge_type === 'hierarchy' || e.edge_type === 'contains';
  return {
    id: i, from: e.from, to: e.to,
    label: isContains ? '' : (e.label || ''), // Show label on edge
    color: { 
      color: isContains ? '#44475A' : '#F8F8F2', // White/Light lines for visibility
      opacity: isContains ? 0.3 : 0.6 
    },
    arrows: isContains ? '' : 'to',
    width: isContains ? 1 : 1.5,
    font: { 
      size: 10, 
      color: '#F8F8F2', // White text
      strokeWidth: 0, 
      background: '#121212', // Dark background for text
      align: 'middle' 
    },
    smooth: { type: 'continuous', roundness: 0 } // Straighter lines like the reference image
  };
});

// 3. Initialize Network
const container = document.getElementById('graph-container');
const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
const options = {
  physics: {
    forceAtlas2Based: {
      gravitationalConstant: -100,
      centralGravity: 0.01,
      springLength: 150,
      springConstant: 0.08,
      damping: 0.4
    },
    maxVelocity: 50,
    solver: 'forceAtlas2Based',
    timestep: 0.35,
    stabilization: { iterations: 200 }
  },
  interaction: { hover: true, tooltipDelay: 200, hideEdgesOnDrag: true },
  layout: { improvedLayout: true }
};
const network = new vis.Network(container, data, options);

// 4. Interaction Logic (Same as before but adapted for Dark Mode)
let impactMode = false;

// Search
document.getElementById('search').addEventListener('input', e => {
  const val = e.target.value.toLowerCase();
  if(!val) { resetView(); return; }
  const matches = data.nodes.get().filter(n => n.label.toLowerCase().includes(val));
  const ids = matches.map(n => n.id);
  data.nodes.forEach(n => {
    data.nodes.update({ id: n.id, opacity: ids.includes(n.id) ? 1 : 0.1 });
  });
  if(ids.length===1) network.focus(ids[0], {scale:1.2, animation:true});
});

// Filter
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    const grp = e.target.dataset.filter;
    data.nodes.forEach(n => {
      const visible = grp === 'all' || n.group === grp || n.group === 'platform';
      data.nodes.update({id: n.id, opacity: visible ? 1 : 0.05});
    });
  });
});

// Click
network.on('click', p => {
  if(p.nodes.length) {
    if(impactMode) analyzeImpact(p.nodes[0]);
    else showDetail(p.nodes[0]);
  } else {
    if(!impactMode) closeDetail();
  }
});

function showDetail(nid) {
  const n = data.nodes.get(nid);
  const s = COLORS[n.group];
  const conns = network.getConnectedEdges(nid).map(eid => {
    const e = data.edges.get(eid);
    const isSrc = e.from === nid;
    const neighbor = data.nodes.get(isSrc ? e.to : e.from);
    return { name: neighbor.label.replace('\n',' '), type: e.label, dir: isSrc ? '‚Üí' : '‚Üê', id: neighbor.id };
  });

  const html = `
    <div class="panel-header">
      <div class="panel-badge" style="background:${s.bg};color:#000">${n.group}</div>
      <div class="panel-title" style="color:${s.bg}">${n.label.replace('\n',' ')}</div>
    </div>
    <div class="panel-body">
      <div class="panel-desc" style="color:#eee">${n.title || ''}</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        ${conns.map(c => `
          <div class="rel-item" onclick="network.focus(${c.id}, {scale:1.2, animation:true}); showDetail(${c.id})">
            <span style="color:${s.bg};font-weight:700">${c.dir}</span>
            <span style="flex:1;font-size:13px">${c.name}</span>
            <span class="rel-type">${c.type || 'LINK'}</span>
          </div>
        `).join('')}
      </div>
      <button class="action-btn btn-impact" style="width:100%;margin-top:20px" onclick="enterImpact(${nid})">‚ö° Impact Analysis</button>
    </div>
  `;
  document.getElementById('detail-content').innerHTML = html;
  document.getElementById('detail-panel').classList.add('open');
}

function closeDetail() { document.getElementById('detail-panel').classList.remove('open'); }

// Impact
document.getElementById('impact-btn').addEventListener('click', () => {
  impactMode = !impactMode;
  document.getElementById('impact-banner').classList.toggle('show', impactMode);
  if(!impactMode) resetView();
});

function enterImpact(nid) {
  impactMode = true;
  document.getElementById('impact-banner').classList.add('show');
  analyzeImpact(nid);
}

function exitImpact() {
  impactMode = false;
  document.getElementById('impact-banner').classList.remove('show');
  document.getElementById('impact-list').classList.remove('show');
  resetView();
}

function analyzeImpact(nid) {
  const root = data.nodes.get(nid);
  document.getElementById('impact-msg').innerText = `Impact of: ${root.label.replace('\n',' ')}`;
  
  const affected = new Map();
  const queue = [{id: nid, lvl: 0}];
  affected.set(nid, 0);

  while(queue.length) {
    const {id, lvl} = queue.shift();
    if(lvl >= 3) continue;
    const edges = network.getConnectedEdges(id);
    edges.forEach(eid => {
      const e = data.edges.get(eid);
      let next = null;
      if(e.from === id) next = e.to; // Forward only
      if(next && !affected.has(next)) {
        affected.set(next, lvl+1);
        queue.push({id: next, lvl: lvl+1});
      }
    });
  }

  data.nodes.forEach(n => {
    if(affected.has(n.id)) {
      const lvl = affected.get(n.id);
      data.nodes.update({ 
        id: n.id, opacity: 1, 
        color: { background: lvl===0 ? '#FF453A' : '#fff', border: '#FF453A' },
        font: { color: '#000' }
      });
    } else {
      data.nodes.update({ id: n.id, opacity: 0.1 });
    }
  });

  const list = document.getElementById('impact-content');
  const items = Array.from(affected.entries()).sort((a,b)=>a[1]-b[1]);
  list.innerHTML = items.map(([id, l]) => `
    <div class="impact-row" onclick="network.focus(${id},{scale:1.5,animation:true})">
      <span class="depth-tag">L${l}</span> ${data.nodes.get(id).label.replace('\n',' ')}
    </div>
  `).join('');
  document.getElementById('impact-list').classList.add('show');
}

function resetView() {
  data.nodes.forEach(n => {
    const s = COLORS[n.group] || COLORS.module;
    data.nodes.update({
      id: n.id, opacity: 1,
      color: { background: s.bg, border: s.border },
      font: { color: s.font }
    });
  });
}
</script>
</body>
</html>